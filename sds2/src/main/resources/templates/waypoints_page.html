<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="./style/routes.css">    
    <title>Itinerary</title>
</head>
<body>

    <h1>Itinerary</h1>

    <div th:if="${waypoints == null or #lists.isEmpty(waypoints)}">
        <p>No waypoints found.</p>
    </div>

    <div th:if="${waypoints != null and !#lists.isEmpty(waypoints)}">
        <div th:each="waypoint : ${waypoints}" class="waypoint-item">
            <form class="waypoint-form">
                <input type="hidden" name="name" th:value="${waypoint.name}">
                <input type="hidden" name="address" th:value="${waypoint.address}">
                <input type="hidden" name="latitude" th:value="${waypoint.location.latitude}">
                <input type="hidden" name="longitude" th:value="${waypoint.location.longitude}">
            </form>

            <h2 th:text="${waypoint.name}"></h2>
            <p>Lat: <span th:text="${waypoint.location.latitude}"></span></p>
            <p>Lng: <span th:text="${waypoint.location.longitude}"></span></p>
            <p>Address: <span th:text="${waypoint.address}"></span></p>
            <hr>
        </div>
    </div>

    <h2>Create Route</h2>

    <form th:action="@{/routes/create/{destination}(destination=${city})}" method="post" style="display: flex;" id="route-form">
        <input hidden name="destination" id="city-input" th:value="${city}" />
        <div id="autocomplete-div">
            <label>Starting point:</label>
            <button id="use-location-btn" type="button">Use my location</button>
        </div>
        <label>Destination (choose waypoint):</label>
        <select id="destination-select" name="destination" required>
            <option th:each="w : ${waypoints}"
                    th:value="${w.location.latitude + ',' + w.location.longitude}"
                    th:text="${w.name}">
            </option>
        </select>
        <select id="travel-mode-select" name="travelMode" required>
            <option value="DRIVE">Driving</option>
            <option value="WALK">Walking</option>
            <option value="BICYCLE">Bicycling</option>
            <option value="TRANSIT">Transit</option>
            <option value="TWO_WHEELER">Two Wheeler</option>
        </select>
        <input type="time" id="departure-time" name="departureTime" placeholder="Departure Time" required>
        <button id="compute-route-btn" type="submit">Compute Route</button>
        <input type="hidden" id="intermediates-input" name="intermediates" />
    </form>

    <div id="map" style="width: 100%; height: 500px;"></div>

    <script src="/scripts/routes_manager.js"></script>

    <script type="module"
            src="https://unpkg.com/@googlemaps/extended-component-library@0.6.0/dist/index.min.js">
    </script>

    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCKmFHtLzbE2Q6tHjZi2h31tBgkNfSoD8U&libraries=places,marker,geometry&callback=initMap"
        async defer>
    </script>

</body>
</html>
